<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Force Placement Calculator</title> <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet"> <link href="https://api.mapbox.com/mapbox-assembly/v1.3.0/assembly.min.css" rel="stylesheet"> <script id="search-js" defer="" src="https://api.mapbox.com/search-js/v1.3.0/web.js"></script> <style> * { box-sizing: border-box; margin: 0; padding: 0; } body { font-family: Manrope, Helvetica, Arial, sans-serif; line-height: 1.6; color: #1e293b; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); min-height: 100vh; font-weight: 400; } .calculator-container { max-width: 1200px; margin: 40px auto; position: relative; z-index: 1; } .header { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; padding: 40px 40px 30px 40px; text-align: center; border-radius: 20px 20px 0 0; position: relative; overflow: hidden; box-shadow: 0 4px 20px rgba(59, 130, 246, 0.15); border: 1px solid rgba(255, 255, 255, 0.2); border-bottom: none; } .header h1 { font-size: 48px; line-height: 58px; margin-bottom: 8px; font-weight: 700; font-style: normal; position: relative; z-index: 2; color: white; } .header p { font-size: 1.1rem; opacity: 0.9; font-weight: 500; position: relative; z-index: 2; color: white; } .tabs { display: flex; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(148, 163, 184, 0.2); border-top: none; border-radius: 0; gap: 2px; padding: 4px; } .tab { flex: 1; padding: 20px 28px; text-align: center; cursor: pointer; background: transparent; border: none; font-size: 18px; line-height: 28px; font-weight: 700; font-style: normal; color: rgb(11, 11, 51); transition: all 0.3s ease; position: relative; border-radius: 12px; } .tab::after { content: ''; position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%); width: 0; height: 3px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); transition: all 0.3s ease; border-radius: 2px; } .tab:hover { color: #3b82f6; background: rgba(59, 130, 246, 0.08); transform: translateY(-2px); } .tab:hover::after { width: 60%; } .tab.active { color: #3b82f6; background: rgba(255, 255, 255, 1); font-weight: 700; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); transform: translateY(-2px); } .tab.active::after { width: 60%; } .tab-content { display: none; padding: 40px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-radius: 0 0 20px 20px; box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.1); border: 1px solid rgba(148, 163, 184, 0.2); border-top: none; } .tab-content.active { display: block; } .disclaimer { background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border: 1px solid #0ea5e9; border-radius: 12px; padding: 16px 20px; margin-top: 30px; color: #0c4a6e; font-size: 14px; line-height: 1.5; padding-left: 44px; position: relative; } .disclaimer::before { content: 'ℹ️'; position: absolute; left: 20px; top: 16px; font-size: 16px; } .form-grid { align-items: start; display: grid; grid-template-columns: 1fr 1fr; gap: 40px; } .form-column { display: flex; flex-direction: column; } .form-group { margin-bottom: 24px; } .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #1e293b; font-size: 14px; } .form-group select, .form-group input { width: 100%; padding: 16px 20px; border: 2px solid #e2e8f0; border-radius: 16px; font-size: 15px; font-family: inherit; font-weight: 500; transition: all 0.3s ease; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); } .form-group select:focus, .form-group input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); background: rgba(255, 255, 255, 0.95); transform: translateY(-2px); } .form-group select:hover, .form-group input:hover { border-color: rgba(59, 130, 246, 0.3); transform: translateY(-1px); } .address-info { background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 12px; padding: 12px 16px; margin-top: 8px; font-size: 13px; color: #0c4a6e; } .results { background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%); backdrop-filter: blur(20px); border-radius: 24px; padding: 28px; border: 1px solid rgba(255, 255, 255, 0.3); height: fit-content; position: relative; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.08); } .results h3 { color: #1e293b; margin-bottom: 20px; font-size: 1.3rem; text-align: center; font-weight: 700; } .result-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(148, 163, 184, 0.1); } .result-row:last-child { border-bottom: none; margin: 16px -16px -16px -16px; padding: 20px 16px; background: linear-gradient(135deg, #00FFA3 0%, #03DAC6 100%); color: #1e293b; border-radius: 16px; font-weight: 700; font-size: 17px; box-shadow: 0 8px 25px -5px rgba(0, 255, 163, 0.3); } .result-label { color: #64748b; font-size: 14px; font-weight: 500; } .result-value { font-weight: 700; color: #1e293b; font-size: 15px; } .result-row:last-child .result-label, .result-row:last-child .result-value { color: #1e293b; font-weight: 800; } /* Special styling for return premium - bright mint */ .return-premium-row { background: linear-gradient(135deg, #00FFA3 0%, #03DAC6 100%) !important; color: #1e293b !important; box-shadow: 0 8px 25px -5px rgba(0, 255, 163, 0.3); margin: 16px -16px -16px -16px; padding: 20px 16px; border-radius: 16px; font-weight: 700; font-size: 17px; } .return-premium-row .result-label, .return-premium-row .result-value { color: #1e293b !important; font-weight: 800; } /* Purple gradient for Coverage Amount, Building Premium, and Earned Premium */ .coverage-amount-row { background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%) !important; color: white !important; margin: 16px -16px 16px -16px; padding: 20px 16px; border-radius: 16px; font-weight: 700; font-size: 17px; box-shadow: 0 8px 25px -5px rgba(79, 70, 229, 0.3); } .coverage-amount-row .result-label, .coverage-amount-row .result-value { color: white !important; font-weight: 800; } .building-premium-row { background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%) !important; color: white !important; margin: 16px -16px 16px -16px; padding: 20px 16px; border-radius: 16px; font-weight: 700; font-size: 17px; box-shadow: 0 8px 25px -5px rgba(79, 70, 229, 0.3); } .building-premium-row .result-label, .building-premium-row .result-value { color: white !important; font-weight: 800; } .earned-premium-row { background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%) !important; color: white !important; margin: 16px -16px 16px -16px; padding: 20px 16px; border-radius: 16px; font-weight: 700; font-size: 17px; box-shadow: 0 8px 25px -5px rgba(79, 70, 229, 0.3); } .earned-premium-row .result-label, .earned-premium-row .result-value { color: white !important; font-weight: 800; } .status-indicator { display: block; padding: 10px 16px; border-radius: 50px; font-size: 13px; font-weight: 600; text-align: center; margin-bottom: 18px; } .status-missing { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white; box-shadow: 0 4px 14px 0 rgba(251, 191, 36, 0.25); } .status-prompt { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; box-shadow: 0 4px 14px 0 rgba(59, 130, 246, 0.25); } .status-complete { background: linear-gradient(135deg, #10b981, #059669); color: white; box-shadow: 0 4px 14px 0 rgba(16, 185, 129, 0.25); } /* Responsive Design */ @media (max-width: 768px) { .calculator-container { margin: 20px; } .form-grid { align-items: start; grid-template-columns: 1fr; gap: 30px; } .tabs { flex-direction: column; } .tab { border-bottom: 1px solid rgba(148, 163, 184, 0.1); } .header h1 { font-size: 1.75rem; } .tab-content { padding: 30px 24px; } } @media (max-width: 480px) { .header { padding: 24px 20px; } .tab-content { padding: 24px 20px; } .form-grid { align-items: start; gap: 24px; } .results { padding: 20px; } } /* Compact vertical rhythm */ .form-group { margin-bottom: 10px; } .input, .select { padding: 8px 10px; font-size: 14px; } label { margin-bottom: 4px; display: inline-block; } /* Results card spacing */ .results-card .row { padding: 8px 0; } /* Smaller info bubble + pills */ #address-info { padding: 10px 12px; } .pill { padding: 2px 8px; font-size: 12px; } /* Compact banner that can hold pills on the right */ .results-banner { gap: 10px; } .results-banner-pills { gap: 6px; } .pill.pill--invert { padding: 2px 8px; font-size: 12px; } .pill-label { font-size: 11px; opacity: 0.8; margin-right: 2px; } /* results banner in the blue card */ .results-banner{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px 12px; margin:8px 0 6px 0; background:#e8f3ff; border:1px solid #b6dbff; border-radius:10px; font-weight:600; color:#0b3d7a; } .results-banner-pills{ display:flex; gap:6px; flex-wrap:wrap; } .pill--invert{ background:#0b3d7a; color:#fff; } /* keep Mapbox results clickable and on top */ [class$="--Results"]{ z-index: 9999 !important; } /* Coverage input styling */ .coverage-input-group { position: relative; } .coverage-limit-info { font-size: 12px; color: #64748b; margin-top: 4px; } .input-error { border-color: #ef4444 !important; box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1) !important; } .error-message { font-size: 12px; color: #ef4444; margin-top: 4px; } /* Alignment tweak so left inputs and right results start at same top line */ .tab-content .form-grid{align-items:start;} .tab-content .form-grid .form-column:first-child{margin-top:0;} .tab-content .form-grid .form-column .form-group:first-child{margin-top:0;} .tab-content .form-grid .results{margin-top:0 !important; padding-top:0;} .tab-content .form-grid .results h3{margin-top:0;} .tab-content .form-grid .results .results-banner{margin-top:0;} </style> </head> <body> <div class="calculator-container"> <div class="header"> <h1>Force Placement Calculator</h1> <p>Use to calculate approximate FPI costs and proration</p> </div> <div class="tabs"> <button class="tab active" onclick="showTab('fpi', this)">Hazard FPI Calculator</button> <button class="tab" onclick="showTab('flood', this)">Flood FPI Calculator</button> <button class="tab" onclick="showTab('cancellation', this)">Cancellation Estimator</button> </div> <div class="tab-content-wrapper"> <!-- FPI Calculator Tab --> <div id="fpi" class="tab-content active"> <div class="form-grid"> <div class="form-column"> <!-- Property Address for FPI --> <div class="form-group"> <h4>Property Address:</h4> <mapbox-address-autofill access-token="pk.eyJ1IjoiYnZpZ2lsODkiLCJhIjoiY21ldnhvd2I5MG4yMzJscTV0eHZldWJsdiJ9.OV_nxhcAuREExQN_sr9oJg"> <label for="fpi-address-input" style="display: block; margin-bottom: 6px; font-weight: 600; color: #1e293b; font-size: 14px;">Street Address:</label> <input id="fpi-address-input" class="input mb12" name="fpi-address" autocomplete="address-line1" placeholder="Address" style="margin-bottom: 12px;"> <div id="fpi-autocomplete-spacer" style="height:0; pointer-events:none"></div> <div class="flex" style="display:flex; gap:6px; align-items:center; flex-wrap:wrap;"> <input type="hidden" id="fpi-city" name="fpi-city"> <input type="hidden" id="fpi-state" name="fpi-state"> <input type="hidden" id="fpi-zip" name="fpi-zip"> <div id="fpi-detected-pills" style="display:flex; gap:6px; flex-wrap:wrap;"> <span id="fpi-city-pill" class="pill" style="display:none;"></span> <span id="fpi-state-pill" class="pill" style="display:none;"></span> <span id="fpi-zip-pill" class="pill" style="display:none;"></span> </div> </div> </mapbox-address-autofill> </div> <div class="form-group"> <label for="fpi-policy-type">Policy Type:</label> <select id="fpi-policy-type" onchange="calculateFPI()"> <option value="">Select Policy Type</option> <option value="hazard-wind">Hazard + Wind</option> <option value="wind-only">Wind Only</option> </select> </div> <div class="form-group"> <label for="fpi-category">Property Category:</label> <select id="fpi-category" onchange="toggleVacancyField(); calculateFPI()"> <option value="">Select Category</option> <option value="residential">Residential (1-4 Family)</option> <option value="commercial">Commercial Buildings</option> <option value="mobile">Mobile Homes</option> </select> </div> <div class="form-group" id="vacancy-group" style="display: none;"> <label for="fpi-vacancy">Vacancy Status:</label> <select id="fpi-vacancy" onchange="calculateFPI()"> <option value="">Select Vacancy Status</option> <option value="occupied">Occupied</option> <option value="vacant">Vacant</option> </select> </div> <div class="form-group"> <label for="fpi-coverage">Coverage Amount ($):</label> <input type="text" id="fpi-coverage" placeholder="Enter coverage amount" oninput="formatCurrency(this); calculateFPI()"> </div> </div> <div class="form-column"> <div class="results"> <h3>Hazard FPI Quote Results</h3> <!-- FPI Results banner (with location pills) --> <div id="fpi-results-banner" class="results-banner"> <span id="fpi-results-banner-text">Next: Select a policy type to begin</span> <div id="fpi-results-banner-pills" class="results-banner-pills" style="display:none"> <span id="fpi-rb-city" class="pill pill--invert" style="display:none"></span> <span id="fpi-rb-state" class="pill pill--invert" style="display:none"></span> <span id="fpi-rb-county" class="pill pill--invert" style="display:none"></span> </div> </div> <div class="result-row coverage-amount-row"> <span class="result-label">Coverage Amount:</span> <span class="result-value" id="fpi-coverage-display">$0.00</span> </div> <div class="result-row"> <span class="result-label">Rate per $100:</span> <span class="result-value" id="fpi-rate-display">$0.00</span> </div> <div class="result-row"> <span class="result-label">Premium (pre-tax):</span> <span class="result-value" id="fpi-premium-display">$0.00</span> </div> <div class="result-row"> <span class="result-label" id="fpi-surplus-tax-label">Surplus Lines Tax (5%):</span> <span class="result-value" id="fpi-surplus-tax-display">$0.00</span> </div> <div class="result-row"> <span class="result-label" id="fpi-stamp-tax-label">Stamping / Service Fee (0.2%):</span> <span class="result-value" id="fpi-stamp-tax-display">$0.00</span> </div> <div class="result-row"> <span class="result-label">Total Premium:</span> <span class="result-value" id="fpi-total-display">$0.00</span> </div> </div> </div> </div> <div class="disclaimer"> This quote calculator is for informational purposes only. Please reach out to your insurance provider to verify the quote and obtain accurate pricing. </div> </div> <!-- Enhanced Flood Calculator Tab --> <div id="flood" class="tab-content"> <div class="form-grid"> <div class="form-column"> <!-- Minimal test - exactly like your working example --> <div class="form-group"> <h4>Property Address:</h4> <mapbox-address-autofill access-token="pk.eyJ1IjoiYnZpZ2lsODkiLCJhIjoiY21ldnhvd2I5MG4yMzJscTV0eHZldWJsdiJ9.OV_nxhcAuREExQN_sr9oJg"> <label for="address-input" style="display: block; margin-bottom: 6px; font-weight: 600; color: #1e293b; font-size: 14px;">Street Address:</label> <input id="address-input" class="input mb12" name="address" autocomplete="address-line1" placeholder="Address" style="margin-bottom: 12px;"> <div id="autocomplete-spacer" style="height:0; pointer-events:none"></div> <div class="flex" style="display:flex; gap:6px; align-items:center; flex-wrap:wrap;"> <!-- Hidden fields retained for logic compatibility --> <input type="hidden" id="flood-city" name="city"> <input type="hidden" id="flood-state" name="state"> <input type="hidden" id="flood-zip" name="zip"> <!-- Compact "detected" pills --> <div id="detected-pills" style="display:flex; gap:6px; flex-wrap:wrap;"> <span id="city-pill" class="pill" style="display:none;"></span> <span id="state-pill" class="pill" style="display:none;"></span> <span id="zip-pill" class="pill" style="display:none;"></span> </div> </div> </mapbox-address-autofill> </div> <div class="form-group"> <label for="flood-category">Structure Type:</label> <select id="flood-category" onchange="updateFloodCoverage(); calculateFlood()"> <option value="">Select Structure Type</option> <option value="Residential (1-4 Unit)">Residential (1-4 Unit)</option> <option value="Residential Condominium Units">Residential Condominium Units</option> <option value="Manufactured or Mobile Homes">Manufactured/Mobile Homes</option> <option value="Other Residential and Commercial Buildings">Other Residential and Commercial Buildings</option> </select> </div> <div class="form-group"> <label for="flood-zone">Flood Zone:</label> <select id="flood-zone" onchange="calculateFlood()"> <option value="">Select Flood Zone</option> <option value="A">Zone A</option> <option value="A99R">Zone A99R</option> <option value="NSFH">Zone NSFH</option> <option value="V">Zone V</option> </select> </div> <div class="form-group" id="coastal-designation-group" style="display: none;"> <label for="coastal-designation">Coastal Designation:</label> <select id="coastal-designation" onchange="calculateFlood()"> <option value="">Standard Rate</option> <option value="CHRA">Coastal High Risk Area (CHRA)</option> <option value="CHR2">Coastal High Risk Tier 2 (CHR2)</option> </select> </div> <!-- Building Coverage Input --> <div class="form-group coverage-input-group" id="building-coverage-group"> <label for="flood-building-coverage">Building Coverage Amount ($):</label> <input type="text" id="flood-building-coverage" placeholder="Enter building coverage amount" oninput="formatCurrency(this); validateCoverage('building'); calculateFlood()"> <div class="coverage-limit-info" id="building-limit-info"> Coverage limits set automatically based on property type </div> <div class="error-message" id="building-error" style="display: none;"></div> </div> <div class="form-group"> <label for="flood-contents">Contents Coverage:</label> <select id="flood-contents" onchange="updateContentsDisplay(); calculateFlood()"> <option value="no">No Contents Coverage</option> <option value="yes">Add Contents Coverage</option> </select> </div> <!-- Contents Coverage Input --> <div class="form-group coverage-input-group" id="contents-coverage-group" style="display: none;"> <label for="flood-contents-coverage">Contents Coverage Amount ($):</label> <input type="text" id="flood-contents-coverage" placeholder="Enter contents coverage amount" oninput="formatCurrency(this); validateCoverage('contents'); calculateFlood()"> <div class="coverage-limit-info" id="contents-limit-info"> Contents limits set automatically based on property type </div> <div class="error-message" id="contents-error" style="display: none;"></div> </div> </div> <div class="form-column"> <div class="results"> <h3>Flood FPI Quote Results</h3> <!-- Results banner (hosts "next" text + detected location pills) --> <div id="results-banner" class="results-banner"> <span id="results-banner-text">Next: Select the structure type</span> <div id="results-banner-pills" class="results-banner-pills" style="display:none"> <span id="rb-city" class="pill pill--invert" style="display:none"></span> <span id="rb-state" class="pill pill--invert" style="display:none"></span> <span id="rb-zip" class="pill pill--invert" style="display:none"></span> <span id="rb-county" class="pill pill--invert" style="display:none"></span> </div> </div> <div class="result-row coverage-amount-row"> <span class="result-label">Coverage Amount:</span> <span class="result-value" id="flood-coverage-display">$0.00</span> </div> <div class="result-row" id="contents-premium-row" style="display: none;"> <span class="result-label">Contents Premium:</span> <span class="result-value" id="flood-contents-premium-display">$0.00</span> </div> <div class="result-row"> <span class="result-label">Rate per $100:</span> <span class="result-value" id="flood-rate-display">$0.00</span> </div> <div class="result-row"> <span class="result-label">Premium (pre-tax):</span> <span class="result-value" id="flood-pretax-display">$0.00</span> </div> <div class="result-row"> <span class="result-label">ICC Charge:</span> <span class="result-value" id="flood-icc-display">$0.00</span> </div> <div class="result-row"> <span class="result-label" id="flood-surplus-tax-label">Surplus Lines Tax (5%):</span> <span class="result-value" id="flood-surplus-tax-display">$0.00</span> </div> <div class="result-row"> <span class="result-label" id="flood-stamp-tax-label">Stamping / Service Fee (0.2%):</span> <span class="result-value" id="flood-stamp-tax-display">$0.00</span> </div> <div class="result-row"> <span class="result-label">Total Premium:</span> <span class="result-value" id="flood-total-display">$0.00</span> </div> </div> </div> </div> <div class="disclaimer"> This quote calculator is for informational purposes only. Please reach out to your insurance provider to verify the quote and obtain accurate pricing. </div> </div> <!-- Cancellation Calculator Tab --> <div id="cancellation" class="tab-content"> <div class="form-grid"> <div class="form-column"> <div class="form-group"> <label for="cancel-policy-type">Policy Type:</label> <select id="cancel-policy-type" onchange="calculateCancellation()"> <option value="">Select Policy Type</option> <option value="fpi">FPI (Short Rate)</option> <option value="flood">Flood (Pro-Rata)</option> </select> </div> <div class="form-group"> <label for="cancel-issue-date">Policy Issue Date:</label> <input type="date" id="cancel-issue-date" onchange="calculateCancellation()"> </div> <div class="form-group"> <label for="cancel-cancel-date">Cancellation Date:</label> <input type="date" id="cancel-cancel-date" onchange="calculateCancellation()"> </div> <div class="form-group"> <label for="cancel-premium">Annual Premium ($):</label> <input type="text" id="cancel-premium" placeholder="Enter annual premium" oninput="formatCurrency(this); calculateCancellation()"> </div> </div> <div class="form-column"> <div class="results"> <h3>Prorated Cancellation Results</h3> <div id="cancel-status" class="status-indicator status-missing" style="display: none;">Ready to calculate</div> <div class="result-row earned-premium-row"> <span class="result-label">Earned Premium:</span> <span class="result-value" id="cancel-earned-display">$0.00</span> </div> <div class="result-row"> <span class="result-label">Days in Force:</span> <span class="result-value" id="cancel-days-display">0</span> </div> <div class="result-row"> <span class="result-label">Calculation Method:</span> <span class="result-value" id="cancel-method-display">-</span> </div> <div class="result-row"> <span class="result-label">Earned Percentage:</span> <span class="result-value" id="cancel-percent-display">0%</span> </div> <div class="result-row return-premium-row"> <span class="result-label">Return Premium:</span> <span class="result-value" id="cancel-return-display">$0.00</span> </div> </div> </div> </div> <div class="disclaimer"> This cancellation calculator is for informational purposes only. Please reach out to your insurance provider to verify cancellation terms and return premium calculations. </div> </div> </div> </div> <script> // Keeps content below from being covered by the Mapbox suggestions list (function setupAutocompleteSpacer(){ const spacer = () => document.getElementById('autocomplete-spacer'); const addr = () => document.getElementById('address-input'); function getResultsEl(){ // Mapbox renders classes like "mbxXYZ--Results" // We pick the *closest* results element under the same container const all = Array.from(document.querySelectorAll('[class$="--Results"]')); if (!all.length) return null; // choose the one visually near the input const a = addr(); if (!a) return all[0]; const ay = a.getBoundingClientRect().top; return all.sort((r1, r2) => Math.abs(r1.getBoundingClientRect().top - ay) - Math.abs(r2.getBoundingClientRect().top - ay) )[0]; } function applySpacer(){ const s = spacer(); const el = getResultsEl(); if (!s) return; if (!el) { // No results element, clear spacer s.style.height = '0'; return; } const hidden = el.getAttribute('aria-hidden') === 'true'; const computedStyle = window.getComputedStyle(el); const isVisible = computedStyle.display !== 'none' && computedStyle.visibility !== 'hidden'; if (hidden || !isVisible) { s.style.height = '0'; } else { const h = Math.ceil(el.getBoundingClientRect().height); s.style.height = h ? (h + 6) + 'px' : '0'; } } // Watch the results element for show/hide/resize function observe(){ const el = getResultsEl(); if (!el) { // Try again in a bit setTimeout(observe, 100); return; } const obs = new MutationObserver(() => { setTimeout(applySpacer, 10); // Small delay to allow DOM changes to settle }); obs.observe(el, { attributes: true, attributeFilter: ['style','class','aria-hidden'], childList: true, subtree: true }); // Also update on input while typing const a = addr(); if (a) { a.addEventListener('input', () => setTimeout(applySpacer, 50)); a.addEventListener('focus', () => setTimeout(applySpacer, 100)); a.addEventListener('blur', () => setTimeout(applySpacer, 200)); } window.addEventListener('resize', applySpacer); applySpacer(); } // Initialize when DOM is ready if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', observe); } else { observe(); } })(); // Setup autocomplete spacer for FPI address input too (function setupFPIAutocompleteSpacer(){ const spacer = () => document.getElementById('fpi-autocomplete-spacer'); const addr = () => document.getElementById('fpi-address-input'); function getResultsEl(){ const all = Array.from(document.querySelectorAll('[class$="--Results"]')); if (!all.length) return null; const a = addr(); if (!a) return all[0]; const ay = a.getBoundingClientRect().top; return all.sort((r1, r2) => Math.abs(r1.getBoundingClientRect().top - ay) - Math.abs(r2.getBoundingClientRect().top - ay) )[0]; } function applySpacer(){ const s = spacer(); const el = getResultsEl(); if (!s) return; if (!el) { // No results element, clear spacer s.style.height = '0'; return; } const hidden = el.getAttribute('aria-hidden') === 'true'; const computedStyle = window.getComputedStyle(el); const isVisible = computedStyle.display !== 'none' && computedStyle.visibility !== 'hidden'; if (hidden || !isVisible) { s.style.height = '0'; } else { const h = Math.ceil(el.getBoundingClientRect().height); s.style.height = h ? (h + 6) + 'px' : '0'; } } function observe(){ const el = getResultsEl(); if (!el) { // Try again in a bit setTimeout(observe, 100); return; } const obs = new MutationObserver(() => { setTimeout(applySpacer, 10); // Small delay to allow DOM changes to settle }); obs.observe(el, { attributes: true, attributeFilter: ['style','class','aria-hidden'], childList: true, subtree: true }); const a = addr(); if (a) { a.addEventListener('input', () => setTimeout(applySpacer, 50)); a.addEventListener('focus', () => setTimeout(applySpacer, 100)); a.addEventListener('blur', () => setTimeout(applySpacer, 200)); } window.addEventListener('resize', applySpacer); applySpacer(); } if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', observe); } else { observe(); } })(); // Short Rate Cancellation Table from Policy Document (FPI Only) const shortRateTable = { 1: 5, 2: 6, 3: 7, 4: 7, 5: 8, 6: 8, 7: 9, 8: 9, 9: 10, 10: 10, 11: 11, 12: 11, 13: 12, 14: 12, 15: 13, 16: 13, 17: 14, 18: 14, 19: 15, 20: 15, 21: 16, 22: 16, 23: 17, 24: 17, 25: 17, 26: 18, 27: 18, 28: 18, 29: 18, 30: 19, 31: 19, 32: 19, 33: 20, 34: 20, 35: 20, 36: 20, 37: 21, 38: 21, 39: 21, 40: 21, 41: 22, 42: 22, 43: 22, 44: 23, 45: 23, 46: 23, 47: 23, 48: 24, 49: 24, 50: 24, 51: 24, 52: 25, 53: 25, 54: 25, 55: 26, 56: 26, 57: 26, 58: 26, 59: 27, 60: 27, 61: 27, 62: 27, 63: 28, 64: 28, 65: 28, 66: 29, 67: 29, 68: 29, 69: 29, 70: 30, 71: 30, 72: 30, 73: 30, 74: 31, 75: 31, 76: 31, 77: 32, 78: 32, 79: 32, 80: 32, 81: 33, 82: 33, 83: 33, 84: 34, 85: 34, 86: 34, 87: 34, 88: 35, 89: 35, 90: 35, 91: 35, 92: 36, 93: 36, 94: 36, 95: 37, 96: 37, 97: 37, 98: 37, 99: 38, 100: 38, 101: 38, 102: 38, 103: 39, 104: 39, 105: 39, 106: 40, 107: 40, 108: 40, 109: 40, 110: 41, 111: 41, 112: 41, 113: 41, 114: 42, 115: 42, 116: 42, 117: 43, 118: 43, 119: 43, 120: 43, 121: 44, 122: 44, 123: 44, 124: 44, 125: 45, 126: 45, 127: 45, 128: 46, 129: 46, 130: 46, 131: 46, 132: 47, 133: 47, 134: 47, 135: 47, 136: 48, 137: 48, 138: 48, 139: 49, 140: 49, 141: 49, 142: 49, 143: 50, 144: 50, 145: 50, 146: 50, 147: 51, 148: 51, 149: 51, 150: 52, 151: 52, 152: 52, 153: 52, 154: 53, 155: 53, 156: 53, 157: 54, 158: 54, 159: 54, 160: 54, 161: 55, 162: 55, 163: 55, 164: 55, 165: 56, 166: 56, 167: 56, 168: 57, 169: 57, 170: 57, 171: 57, 172: 58, 173: 58, 174: 58, 175: 58, 176: 59, 177: 59, 178: 59, 179: 60, 180: 60, 181: 60, 182: 60, 183: 61, 184: 61, 185: 61, 186: 61, 187: 61, 188: 62, 189: 62, 190: 62, 191: 62, 192: 63, 193: 63, 194: 63, 195: 63, 196: 63, 197: 64, 198: 64, 199: 64, 200: 64 }; // Continue the short rate table for remaining days for (let i = 201; i <= 365; i++) { if (i <= 205) shortRateTable[i] = 65; else if (i <= 209) shortRateTable[i] = 66; else if (i <= 214) shortRateTable[i] = 67; else if (i <= 218) shortRateTable[i] = 68; else if (i <= 223) shortRateTable[i] = 69; else if (i <= 228) shortRateTable[i] = 70; else if (i <= 232) shortRateTable[i] = 71; else if (i <= 237) shortRateTable[i] = 72; else if (i <= 241) shortRateTable[i] = 73; else if (i <= 246) shortRateTable[i] = 74; else if (i <= 250) shortRateTable[i] = 75; else if (i <= 255) shortRateTable[i] = 76; else if (i <= 260) shortRateTable[i] = 77; else if (i <= 264) shortRateTable[i] = 78; else if (i <= 269) shortRateTable[i] = 79; else if (i <= 273) shortRateTable[i] = 80; else if (i <= 278) shortRateTable[i] = 81; else if (i <= 282) shortRateTable[i] = 82; else if (i <= 287) shortRateTable[i] = 83; else if (i <= 291) shortRateTable[i] = 84; else if (i <= 296) shortRateTable[i] = 85; else if (i <= 301) shortRateTable[i] = 86; else if (i <= 305) shortRateTable[i] = 87; else if (i <= 310) shortRateTable[i] = 88; else if (i <= 314) shortRateTable[i] = 89; else if (i <= 319) shortRateTable[i] = 90; else if (i <= 323) shortRateTable[i] = 91; else if (i <= 328) shortRateTable[i] = 92; else if (i <= 332) shortRateTable[i] = 93; else if (i <= 337) shortRateTable[i] = 94; else if (i <= 342) shortRateTable[i] = 95; else if (i <= 346) shortRateTable[i] = 96; else if (i <= 351) shortRateTable[i] = 97; else if (i <= 355) shortRateTable[i] = 98; else if (i <= 360) shortRateTable[i] = 99; else shortRateTable[i] = 100; } // FPI Rate Tables (From Policy Document - All Other Lender Placed rates, no GSE) const fpiRates = { 'hazard-wind': { 'residential': { 'all-except': 1.05, 'ca-hi-coastal': 1.80, 'coastal-gulf': 2.20, 'florida': 3.50, 'florida-miami': 4.00 }, 'commercial-occupied': { 'all-except': 1.15, 'ca-hi-coastal': 1.80, 'coastal-gulf': 2.00, 'florida': 3.50, 'florida-miami': 4.00 }, 'commercial-vacant': { 'all-except': 1.80, 'ca-hi-coastal': 1.80, 'coastal-gulf': 2.20, 'florida': 3.50, 'florida-miami': 4.00 }, 'mobile': { 'all-except': 3.00, 'ca-hi-coastal': 4.00, 'coastal-gulf': 4.00, 'florida': 4.50, 'florida-miami': 5.00 } }, 'wind-only': { 'residential': { 'all-except': 1.00, 'ca-hi-coastal': 1.71, 'coastal-gulf': 2.09, 'florida': 3.33, 'florida-miami': 3.80 }, 'commercial-occupied': { 'all-except': 1.09, 'ca-hi-coastal': 1.71, 'coastal-gulf': 1.90, 'florida': 3.33, 'florida-miami': 3.80 }, 'commercial-vacant': { 'all-except': 1.71, 'ca-hi-coastal': 1.71, 'coastal-gulf': 2.09, 'florida': 3.33, 'florida-miami': 3.80 }, 'mobile': { 'all-except': 2.85, 'ca-hi-coastal': 3.80, 'coastal-gulf': 3.80, 'florida': 4.28, 'florida-miami': 4.75 } } }; // Coastal Counties Data from PDF (abbreviated for key states) const coastalCounties = { tier1: { 'AL': ['Baldwin', 'Mobile'], 'CT': ['Fairfield', 'Middlesex', 'New Haven', 'New London'], 'DE': ['Kent', 'New Castle', 'Sussex'], 'FL': ['Bay', 'Brevard', 'Broward', 'Charlotte', 'Citrus', 'Collier', 'Dade', 'Dixie', 'Duval', 'Escambia', 'Flagler', 'Franklin', 'Gulf', 'Hernando', 'Hillsborough', 'Indian River', 'Jefferson', 'Lee', 'Levy', 'Manatee', 'Martin', 'Monroe', 'Nassau', 'Okaloosa', 'Palm Beach', 'Pasco', 'Pinellas', 'St. Johns', 'St. Lucie', 'Santa Rosa', 'Sarasota', 'Taylor', 'Volusia', 'Wakulla', 'Walton'], 'GA': ['Bryan', 'Camden', 'Chatham', 'Glynn', 'Liberty', 'McIntosh'], 'LA': ['Cameron', 'Iberia', 'Jefferson', 'Lafourche', 'Orleans', 'Plaquemines', 'St. Bernard', 'St. Mary', 'St. Tammany', 'Terrebonne', 'Vermilion'], 'ME': ['Cumberland', 'Hancock', 'Knox', 'Lincoln', 'Sagadahoc', 'Waldo', 'Washington', 'York'], 'MD': ['Somerset', 'Worcester'], 'MA': ['Barnstable', 'Bristol', 'Dukes', 'Essex', 'Middlesex', 'Nantucket', 'Norfolk', 'Plymouth', 'Suffolk'], 'MS': ['Hancock', 'Harrison', 'Jackson'], 'NH': ['Rockingham'], 'NJ': ['Atlantic', 'Cape May', 'Cumberland', 'Middlesex', 'Monmouth', 'Ocean', 'Salem'], 'NY': ['Bronx', 'Kings', 'Nassau', 'Queens', 'Richmond', 'Suffolk', 'Westchester'], 'NC': ['Beaufort', 'Brunswick', 'Camden', 'Carteret', 'Craven', 'Currituck', 'Dare', 'Hyde', 'New Hanover', 'Onslow', 'Pamlico', 'Pender', 'Tyrrell', 'Washington'], 'RI': ['Bristol', 'Kent', 'Newport', 'Washington'], 'SC': ['Beaufort', 'Charleston', 'Colleton', 'Georgetown', 'Horry'], 'TX': ['Aransas', 'Brazoria', 'Calhoun', 'Cameron', 'Chambers', 'Galveston', 'Jefferson', 'Kenedy', 'Kleberg', 'Matagorda', 'Nueces', 'Refugio', 'San Patricio', 'Willacy'], 'VA': ['Accomack', 'Gloucester', 'Lancaster', 'Mathews', 'Middlesex', 'Northampton', 'Northumberland', 'York'] }, tier2: { 'AL': ['Clarke', 'Covington', 'Escambia', 'Geneva', 'Monroe', 'Washington'], 'CT': ['Hartford', 'Litchfield', 'Tolland', 'Windham'], 'FL': ['Alachua', 'Baker', 'Calhoun', 'Clay', 'De Soto', 'Gilchrist', 'Glades', 'Hardee', 'Hendry', 'Holmes', 'Lafayette', 'Lake', 'Leon', 'Liberty', 'Madison', 'Marion', 'Okeechobee', 'Orange', 'Osceola', 'Polk', 'Putnam', 'Seminole', 'Sumter', 'Washington'], 'GA': ['Brantley', 'Bulloch', 'Charlton', 'Effingham', 'Evans', 'Long', 'Thomas', 'Wayne'], 'LA': ['Acadia', 'Assumption', 'Calcasieu', 'Iberville', 'Jefferson Davis', 'Lafayette', 'St. Charles', 'St. James', 'St. John the Baptist', 'St. Martin', 'Tangipahoa', 'Washington'], 'ME': ['Androscoggin', 'Kennebec', 'Oxford', 'Penobscot'], 'MD': ['Anne Arundel', 'Baltimore', 'Calvert', 'Caroline', 'Cecil', 'Dorchester', 'Harford', 'Kent', 'Queen Annes', 'St. Marys', 'Talbot', 'Wicomico'], 'MA': ['Worcester'], 'MS': ['George', 'Greene', 'Pearl River', 'Stone'], 'NH': ['Carroll', 'Hillsborough', 'Merrimack', 'Strafford'], 'NJ': ['Bergen', 'Burlington', 'Camden', 'Essex', 'Gloucester', 'Hudson', 'Mercer', 'Passaic', 'Somerset', 'Union'], 'NY': ['New York', 'Putnam', 'Rockland'], 'NC': ['Bertie', 'Bladen', 'Chowan', 'Columbus', 'Duplin', 'Gates', 'Jones', 'Lenoir', 'Martin', 'Pasquotank', 'Perquimans', 'Pitt', 'Sampson'], 'RI': ['Providence'], 'SC': ['Bamberg', 'Berkeley', 'Dorchester', 'Hampton', 'Jasper', 'Marion', 'Williamsburg'], 'TX': ['Bee', 'Brooks', 'Fort Bend', 'Goliad', 'Hardin', 'Harris', 'Hidalgo', 'Jackson', 'Jim Wells', 'Liberty', 'Live Oak', 'Orange', 'Victoria', 'Wharton'], 'VA': ['Essex', 'Isle of Wight', 'James City', 'King and Queen', 'Richmond', 'Southampton', 'Surry', 'Westmoreland'] } }; // Louisiana special designations const chr2Counties = ['East Baton Rouge', 'West Baton Rouge']; const louisianaCHRACounties = [ 'Ascension', 'Jefferson', 'Lafourche', 'Livingston', 'Orleans', 'Plaquemines', 'St. Charles', 'St. Bernard', 'St. Helena', 'St. James', 'St. John the Baptist', 'St. Tammany', 'Tangipahoa', 'Terrebonne', 'Washington' ]; // Flood Rate Tables from Policy Document const floodRates = { building: { 'Residential (1-4 Unit)': { 'A': { 'default': { rate: 0.99, icc: 33, minPrem: 190 }, 'GA,NC,SC,VA': { rate: 1.04, icc: 33, minPrem: 190 }, 'MA': { rate: 0.89, icc: 33, minPrem: 190 }, 'HI': { rate: 1.75, icc: 33, minPrem: 190 }, 'LA': { rate: 2.25, icc: 33, minPrem: 190 }, 'FL': { rate: 1.65, icc: 33, minPrem: 190 }, 'AL,MS,TX': { rate: 1.35, icc: 33, minPrem: 190 } }, 'A99R': { 'default': { rate: 0.60, icc: 6, minPrem: 60 }, 'MA': { rate: 0.54, icc: 6, minPrem: 60 }, 'HI': { rate: 1.75, icc: 6, minPrem: 60 }, 'LA': { rate: 2.14, icc: 6, minPrem: 60 } }, 'NSFH': { 'default': { rate: 0.80, icc: 33, minPrem: 190 }, 'AL,FL,GA,MS,NC,SC,TX,VA': { rate: 0.99, icc: 33, minPrem: 190 }, 'MA': { rate: 0.72, icc: 33, minPrem: 190 }, 'HI': { rate: 1.75, icc: 33, minPrem: 190 }, 'LA': { rate: 1.95, icc: 33, minPrem: 190 } }, 'V': { 'default': { rate: 3.00, icc: 48, minPrem: 190 }, 'MA': { rate: 2.70, icc: 48, minPrem: 190 }, 'LA': { rate: 5.00, icc: 48, minPrem: 190 } } } // Add other property types as needed from your existing data } }; // Coverage limits by property type const floodCoverageLimits = { 'Residential (1-4 Unit)': { building: 250000, contents: 100000 }, 'Residential Condominium Units': { building: 0, contents: 100000 }, 'Manufactured or Mobile Homes': { building: 250000, contents: 100000 }, 'Other Residential and Commercial Buildings': { building: 500000, contents: 500000 } }; // State-specific tax rates (updated with accurate 2025 rates) const stateTaxRates = { 'FL': { surplusLines: 0.0494, stamping: 0.0006 }, // 4.94% surplus, 0.06% stamping 'CA': { surplusLines: 0.03, stamping: 0.0018 }, // 3% surplus, 0.18% stamping 'TX': { surplusLines: 0.048, stamping: 0.002 }, // 4.8% surplus, 0.2% stamping 'NY': { surplusLines: 0.036, stamping: 0.0015 }, // 3.6% surplus, 0.15% stamping 'LA': { surplusLines: 0.05, stamping: 0.004 }, // 5% surplus, 0.4% stamping 'WA': { surplusLines: 0.02, stamping: 0.003 }, // 2% surplus, 0.30% stamping 'CO': { surplusLines: 0.03, stamping: 0.00175 }, // 3% surplus, 0.175% transaction fee 'HI': { surplusLines: 0.0468, stamping: 0.002 }, // 4.68% surplus, 0.2% stamping 'MN': { surplusLines: 0.03, stamping: 0.002 }, // 3% surplus, 0.2% stamping 'DEFAULT': { surplusLines: 0.05, stamping: 0.002 } // Default rates }; function getStateTaxRates(state) { return stateTaxRates[state] || stateTaxRates['DEFAULT']; } // Function to update tax labels based on current state function updateTaxLabels(state, prefix = '') { const surplusLabel = document.getElementById(${prefix}surplus-tax-label); const stampLabel = document.getElementById(${prefix}stamp-tax-label); if (state && state !== 'DEFAULT') { const taxRates = getStateTaxRates(state); const surplusPercent = (taxRates.surplusLines * 100).toFixed(2); const stampPercent = (taxRates.stamping * 100).toFixed(2); if (surplusLabel) { surplusLabel.textContent = Surplus Lines Tax (${surplusPercent}%):; } if (stampLabel) { stampLabel.textContent = Stamping / Service Fee (${stampPercent}%):; } } else { // Show generic labels when no state is known if (surplusLabel) { surplusLabel.textContent = 'Surplus Lines Tax:'; } if (stampLabel) { stampLabel.textContent = 'Stamping / Service Fee:'; } } } // Global variables let addressLookupData = null; let fpiAddressLookupData = null; let fpiInteracted = false; let floodInteracted = false; let cancelInteracted = false; // ACCESS TOKEN - Same as your working example const ACCESS_TOKEN = 'pk.eyJ1IjoiYnZpZ2lsODkiLCJhIjoiY21ldnhvd2I5MG4yMzJscTV0eHZldWJsdiJ9.OV_nxhcAuREExQN_sr9oJg'; // Initialize Mapbox address autofill (same as working example) window.addEventListener('load', () => { const elements = document.querySelectorAll('mapbox-address-autofill'); for (const autofill of elements) { autofill.accessToken = ACCESS_TOKEN; // Listen for different possible events ['retrieve', 'change', 'suggestion_selected'].forEach(eventName => { autofill.addEventListener(eventName, (event) => { console.log(Event triggered: ${eventName}, event); if (event.detail && event.detail.features && event.detail.features[0]) { // Check which input this is for const input = autofill.querySelector('input'); if (input && input.id === 'fpi-address-input') { processFPISelectedAddress(event.detail.features[0]); } else { processSelectedAddress(event.detail.features[0]); } } }); }); // Also listen on the input itself for changes const input = autofill.querySelector('input'); if (input) { input.addEventListener('input', (event) => { console.log('Input changed:', event.target.value); // Delay processing to allow Mapbox to populate hidden fields setTimeout(() => { if (input.id === 'fpi-address-input') { checkForFPIAddressData(); } else { checkForAddressData(); } }, 100); }); } } }); // Process FPI address selection function processFPISelectedAddress(geoData) { console.log('Processing FPI Mapbox address:', geoData); try { // Put the chosen address text into the visible field const addressInput = document.getElementById('fpi-address-input'); if (addressInput) { const props = geoData.properties || {}; if (props.full_address) { addressInput.value = props.full_address; } else if (geoData.place_name) { addressInput.value = geoData.place_name; } else { addressInput.value = props.feature_name || ''; } } let state = null; let county = null; let city = null; // Extract state, county, and city from geoData const props = geoData.properties || {}; if (props.region_code && typeof props.region_code === 'string') { state = props.region_code.toUpperCase(); } else if (props.address_level1) { state = props.address_level1.toUpperCase(); } else if (props.region) { state = getStateAbbreviation(props.region) || props.region; } if (props.district) { county = props.district; } if (props.place || props.address_level2) { city = props.place || props.address_level2; } const contextArr = (geoData.context && Array.isArray(geoData.context)) ? geoData.context : (Array.isArray(props.context) ? props.context : []); if ((!state || !county) && contextArr.length) { for (const item of contextArr) { if (!state && item.id && item.id.startsWith('region')) { state = item.short_code ? item.short_code.replace(/^US-/, '').toUpperCase() : (getStateAbbreviation(item.text) || item.text); } if (!county && item.id && (item.id.startsWith('district') || item.id.includes('district') || item.id.includes('county'))) { county = item.text; } if (!city && item.id && (item.id.startsWith('place') || item.id.includes('place'))) { city = item.text; } } } if (!state && geoData.place_name) { const parts = geoData.place_name.split(', '); const statePattern = /\b(Alabama|Alaska|Arizona|Arkansas|California|Colorado|Connecticut|Delaware|Florida|Georgia|Hawaii|Idaho|Illinois|Indiana|Iowa|Kansas|Kentucky|Louisiana|Maine|Maryland|Massachusetts|Michigan|Minnesota|Mississippi|Missouri|Montana|Nebraska|Nevada|New Hampshire|New Jersey|New Mexico|New York|North Carolina|North Dakota|Ohio|Oklahoma|Oregon|Pennsylvania|Rhode Island|South Carolina|South Dakota|Tennessee|Texas|Utah|Vermont|Virginia|Washington|West Virginia|Wisconsin|Wyoming|AL|AK|AZ|AR|CA|CO|CT|DE|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY)\b/i; for (const p of parts) { const m = p.match(statePattern); if (m) { state = getStateAbbreviation(m[1]) || m[1].toUpperCase(); break; } } // Also extract city from place_name if not found yet if (!city && parts.length > 0) { city = parts[0]; // Usually the first part is the city } } if (!state) { throw new Error('State not found in address data'); } const stateAbbrev = (state.length === 2 ? state : (getStateAbbreviation(state) || state)).toUpperCase(); const cleanCounty = county ? county.replace(/\s+(County|Parish)$/i, '') : ''; const coastalDesignation = cleanCounty ? determineCoastalDesignation(stateAbbrev, cleanCounty) : null; fpiAddressLookupData = { state: stateAbbrev, county: cleanCounty, city: city, coastalDesignation }; // Fill visible city/state fields const stateEl = document.getElementById('fpi-state'); if (stateEl) stateEl.value = stateAbbrev; const cityEl = document.getElementById('fpi-city'); if (cityEl && city) { cityEl.value = city; } // Update tax labels immediately when state is detected updateTaxLabels(stateAbbrev, 'fpi-'); // Update FPI results banner with location info updateFPIResultsBanner(); calculateFPI(); } catch (error) { console.error('FPI Address processing error:', error); } } // Check for FPI address data while typing function checkForFPIAddressData() { const addressInput = document.getElementById('fpi-address-input'); const stateInput = document.getElementById('fpi-state'); const cityInput = document.getElementById('fpi-city'); const rawState = stateInput?.value?.trim(); if (rawState) { const stateAbbrev = (rawState.length === 2 ? rawState.toUpperCase() : (getStateAbbreviation(rawState) || rawState)); fpiAddressLookupData = { state: stateAbbrev, county: null, coastalDesignation: null }; stateInput.value = stateAbbrev; updateFPIResultsBanner(); calculateFPI(); } } function processSelectedAddress(geoData) { console.log('Processing Mapbox address:', geoData); console.log('Full geoData structure:', JSON.stringify(geoData, null, 2)); try { // Put the chosen address text into the visible field const addressInput = document.getElementById('address-input'); if (addressInput) { // Use Mapbox's nicely formatted "full_address" when available const props = geoData.properties || {}; if (props.full_address) { addressInput.value = props.full_address; } else if (geoData.place_name) { addressInput.value = geoData.place_name; } else { addressInput.value = props.feature_name || ''; } } let state = null; let county = null; let city = null; // Prefer properties.* when available (your payload has these) const props = geoData.properties || {}; // 1) State from properties.region_code (e.g., "CA") or properties.address_level1 if (props.region_code && typeof props.region_code === 'string') { state = props.region_code.toUpperCase(); // already an abbrev like "CA" console.log('Found state via properties.region_code:', state); } else if (props.address_level1) { // sometimes this is a 2-letter code already state = props.address_level1.toUpperCase(); console.log('Found state via properties.address_level1:', state); } else if (props.region) { // full state name -> convert to abbrev state = getStateAbbreviation(props.region) || props.region; console.log('Found state via properties.region:', state); } // 2) County from properties.district when available if (props.district) { county = props.district; console.log('Found county via properties.district:', county); } // 3) City from properties.place or properties.address_level2 if (props.place) { city = props.place; console.log('Found city via properties.place:', city); } else if (props.address_level2) { city = props.address_level2; console.log('Found city via properties.address_level2:', city); } // 4) If still missing, fall back to context (works for both top-level and properties.context) const contextArr = (geoData.context && Array.isArray(geoData.context)) ? geoData.context : (Array.isArray(props.context) ? props.context : []); if ((!state || !county || !city) && contextArr.length) { console.log('Context candidates:', contextArr); for (const item of contextArr) { // State via context item if (!state && item.id && item.id.startsWith('region')) { state = item.short_code ? item.short_code.replace(/^US-/, '').toUpperCase() : (getStateAbbreviation(item.text) || item.text); console.log('Found state via context:', state); } // County via context item if (!county && item.id && (item.id.startsWith('district') || item.id.includes('district') || item.id.includes('county'))) { county = item.text; console.log('Found county via context:', county); } // City via context item if (!city && item.id && (item.id.startsWith('place') || item.id.includes('place'))) { city = item.text; console.log('Found city via context:', city); } } } // 5) Final fallback: parse from place_name if needed if (!state && geoData.place_name) { const parts = geoData.place_name.split(', '); console.log('Place name parts:', parts); const statePattern = /\b(Alabama|Alaska|Arizona|Arkansas|California|Colorado|Connecticut|Delaware|Florida|Georgia|Hawaii|Idaho|Illinois|Indiana|Iowa|Kansas|Kentucky|Louisiana|Maine|Maryland|Massachusetts|Michigan|Minnesota|Mississippi|Missouri|Montana|Nebraska|Nevada|New Hampshire|New Jersey|New Mexico|New York|North Carolina|North Dakota|Ohio|Oklahoma|Oregon|Pennsylvania|Rhode Island|South Carolina|South Dakota|Tennessee|Texas|Utah|Vermont|Virginia|Washington|West Virginia|Wisconsin|Wyoming|AL|AK|AZ|AR|CA|CO|CT|DE|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY)\b/i; for (const p of parts) { const m = p.match(statePattern); if (m) { state = getStateAbbreviation(m[1]) || m[1].toUpperCase(); console.log('Found state via place_name:', state); break; } } // Also extract city from place_name if not found yet if (!city && parts.length > 0) { city = parts[0]; // Usually the first part is the city console.log('Found city via place_name:', city); } } if (!state) { throw new Error('State not found in address data'); } const stateAbbrev = (state.length === 2 ? state : (getStateAbbreviation(state) || state)).toUpperCase(); if (!stateAbbrev || stateAbbrev.length !== 2) { throw new Error(Could not determine state abbreviation for: ${state}); } // Clean county: drop " County" / " Parish" const cleanCounty = county ? county.replace(/\s+(County|Parish)$/i, '') : ''; console.log('Clean county:', cleanCounty); // Figure out coastal designation const coastalDesignation = cleanCounty ? determineCoastalDesignation(stateAbbrev, cleanCounty) : null; console.log('Coastal designation:', coastalDesignation); addressLookupData = { state: stateAbbrev, county: cleanCounty, city: city, coastalDesignation }; // Fill visible city/state fields const stateEl = document.getElementById('flood-state'); if (stateEl) stateEl.value = stateAbbrev; const cityEl = document.getElementById('flood-city'); if (cityEl && city) { cityEl.value = city; } // Update tax labels immediately when state is detected updateTaxLabels(stateAbbrev, 'flood-'); // Recalculate with address-backed data calculateFlood(); updateResultsBanner(); } catch (error) { console.error('Address processing error:', error); showAddressError(error.message); } } // Check if Mapbox has populated any hidden fields or data function checkForAddressData() { // Use the actual input IDs that exist in the flood tool const addressInput = document.getElementById('address-input'); const stateInput = document.getElementById('flood-state'); const cityInput = document.getElementById('flood-city'); console.log('Checking address data:', { address: addressInput?.value, state: stateInput?.value, city: cityInput?.value }); // If state was typed or already filled, normalize it and show info const rawState = stateInput?.value?.trim(); if (rawState) { const stateAbbrev = (rawState.length === 2 ? rawState.toUpperCase() : (getStateAbbreviation(rawState) || rawState)); console.log('Found state from input field:', stateAbbrev); addressLookupData = { state: stateAbbrev, county: null, coastalDesignation: null }; // Update the state input with normalized abbreviation stateInput.value = stateAbbrev; // Auto-calc with what we have calculateFlood(); } updateResultsBanner(); } function showAddressError(message) { // Remove this function - no longer needed console.log('Address processing note:', message); } function getStateAbbreviation(stateName) { const stateMap = { 'Alabama': 'AL', 'Alaska': 'AK', 'Arizona': 'AZ', 'Arkansas': 'AR', 'California': 'CA', 'Colorado': 'CO', 'Connecticut': 'CT', 'Delaware': 'DE', 'Florida': 'FL', 'Georgia': 'GA', 'Hawaii': 'HI', 'Idaho': 'ID', 'Illinois': 'IL', 'Indiana': 'IN', 'Iowa': 'IA', 'Kansas': 'KS', 'Kentucky': 'KY', 'Louisiana': 'LA', 'Maine': 'ME', 'Maryland': 'MD', 'Massachusetts': 'MA', 'Michigan': 'MI', 'Minnesota': 'MN', 'Mississippi': 'MS', 'Missouri': 'MO', 'Montana': 'MT', 'Nebraska': 'NE', 'Nevada': 'NV', 'New Hampshire': 'NH', 'New Jersey': 'NJ', 'New Mexico': 'NM', 'New York': 'NY', 'North Carolina': 'NC', 'North Dakota': 'ND', 'Ohio': 'OH', 'Oklahoma': 'OK', 'Oregon': 'OR', 'Pennsylvania': 'PA', 'Rhode Island': 'RI', 'South Carolina': 'SC', 'South Dakota': 'SD', 'Tennessee': 'TN', 'Texas': 'TX', 'Utah': 'UT', 'Vermont': 'VT', 'Virginia': 'VA', 'Washington': 'WA', 'West Virginia': 'WV', 'Wisconsin': 'WI', 'Wyoming': 'WY' }; return stateMap[stateName]; } function determineCoastalDesignation(state, county) { if (!county) return null; // Check for CHR2 in Louisiana if (state === 'LA' && chr2Counties.some(c => county.toLowerCase().includes(c.toLowerCase()))) { return 'CHR2 (Coastal High Risk Tier 2)'; } // Check for CHRA in Louisiana if (state === 'LA' && louisianaCHRACounties.some(c => county.toLowerCase().includes(c.toLowerCase()))) { return 'CHRA (Coastal High Risk Area)'; } // Check tier 1 coastal counties if (coastalCounties.tier1[state]) { for (const tier1County of coastalCounties.tier1[state]) { if (county.toLowerCase().includes(tier1County.toLowerCase()) || tier1County.toLowerCase().includes(county.toLowerCase())) { if (state === 'LA') { return 'CHRA (Coastal High Risk Area)'; } return 'Tier 1 Coastal County'; } } } // Check tier 2 coastal counties if (coastalCounties.tier2[state]) { for (const tier2County of coastalCounties.tier2[state]) { if (county.toLowerCase().includes(tier2County.toLowerCase()) || tier2County.toLowerCase().includes(county.toLowerCase())) { return 'Tier 2 Coastal County'; } } } return null; // Standard rate } // Helper function to format currency with cents function formatCurrencyValue(amount) { return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(amount); } // Helper function to get today's date in YYYY-MM-DD format function getTodayDate() { const today = new Date(); const year = today.getFullYear(); const month = String(today.getMonth() + 1).padStart(2, '0'); const day = String(today.getDate()).padStart(2, '0'); return ${year}-${month}-${day}; } // Helper function to get date 10 days from today function getDatePlusDays(days) { const date = new Date(); date.setDate(date.getDate() + days); const year = date.getFullYear(); const month = String(date.getMonth() + 1).padStart(2, '0'); const day = String(date.getDate()).padStart(2, '0'); return ${year}-${month}-${day}; } // Set default dates for cancellation calculator function setDefaultDates() { const issueDate = document.getElementById('cancel-issue-date'); const cancelDate = document.getElementById('cancel-cancel-date'); if (issueDate && !issueDate.value) { issueDate.value = getTodayDate(); } if (cancelDate && !cancelDate.value) { cancelDate.value = getDatePlusDays(10); } } function showTab(tabName, tabButton) { // Don't do anything if it's already active if (tabButton.classList.contains('active')) return; // Update tab buttons document.querySelectorAll('.tab').forEach(tab => { tab.classList.remove('active'); }); tabButton.classList.add('active'); // Show/hide content document.querySelectorAll('.tab-content').forEach(content => { content.classList.remove('active'); }); document.getElementById(tabName).classList.add('active'); // Set default dates when cancellation tab is shown if (tabName === 'cancellation') { setTimeout(setDefaultDates, 100); } } // Rest of the existing functions (FPI, Flood, Cancellation calculations) function toggleVacancyField() { const category = document.getElementById('fpi-category').value; const vacancyGroup = document.getElementById('vacancy-group'); if (category === 'commercial') { vacancyGroup.style.display = 'block'; } else { vacancyGroup.style.display = 'none'; document.getElementById('fpi-vacancy').value = ''; } calculateFPI(); } function formatCurrency(input) { let value = input.value.replace(/[^\d]/g, ''); if (value) { value = parseInt(value).toLocaleString(); input.value = value; } } function parseCurrency(value) { // Parse strings like "$250,000.00" or "250000" into a proper number const cleaned = String(value || '').replace(/[^0-9.]/g, ''); const num = parseFloat(cleaned); return isNaN(num) ? 0 : num; } // New function to update FPI results banner function updateFPIResultsBanner() { const textEl = document.getElementById('fpi-results-banner-text'); const pillsEl = document.getElementById('fpi-results-banner-pills'); // Get form state const policyType = document.getElementById('fpi-policy-type').value; const category = document.getElementById('fpi-category').value; const vacancy = document.getElementById('fpi-vacancy').value; const coverageStr = document.getElementById('fpi-coverage').value; // Update status text based on form completion let message = ''; if (!policyType) { message = 'Next: Select a policy type to begin'; } else if (!category) { message = 'Next: Choose the property category'; } else if (category === 'commercial' && !vacancy) { message = 'Next: Specify if commercial property is occupied or vacant'; } else if (!coverageStr) { message = 'Next: Enter coverage amount to complete quote'; } else { message = '✓ Quote calculated successfully'; } if (textEl) textEl.textContent = message; // Update location pills with labels if (fpiAddressLookupData && pillsEl) { const city = fpiAddressLookupData.city; const state = fpiAddressLookupData.state; const county = fpiAddressLookupData.county; const set = (id, label, val) => { const el = document.getElementById(id); if (!el) return; if (val) { el.innerHTML = <span class="pill-label">${label}:</span>${val}; el.style.display = 'inline-block'; } else { el.style.display = 'none'; } }; set('fpi-rb-city', 'City', city); set('fpi-rb-state', 'State', state); set('fpi-rb-county', 'County', county); const hasAnyPill = !!(city || state || county); pillsEl.style.display = hasAnyPill ? 'flex' : 'none'; } else if (pillsEl) { pillsEl.style.display = 'none'; } } function calculateFPI() { const policyType = document.getElementById('fpi-policy-type').value; const category = document.getElementById('fpi-category').value; const vacancy = document.getElementById('fpi-vacancy').value; const coverageStr = document.getElementById('fpi-coverage').value; const coverage = parseCurrency(coverageStr); if (policyType || category || coverageStr) { fpiInteracted = true; } let actualCategory = category; if (category === 'commercial') { if (vacancy === 'occupied') { actualCategory = 'commercial-occupied'; } else if (vacancy === 'vacant') { actualCategory = 'commercial-vacant'; } } // Determine region based on address data let region = 'all-except'; let currentState = 'DEFAULT'; if (fpiAddressLookupData) { const state = fpiAddressLookupData.state; currentState = state; const coastalDesignation = fpiAddressLookupData.coastalDesignation; const county = fpiAddressLookupData.county; // Florida Miami counties get special rate if (state === 'FL' && county) { const miamiCounties = ['miami-dade', 'dade', 'broward', 'palm beach']; const countyLower = county.toLowerCase(); if (miamiCounties.some(c => countyLower.includes(c) || c.includes(countyLower))) { region = 'florida-miami'; } else { region = 'florida'; } } else if (state === 'FL') { region = 'florida'; } else if (['CA', 'HI'].includes(state) || (coastalDesignation && coastalDesignation.includes('Coastal'))) { region = 'ca-hi-coastal'; } else if (['AL', 'MS', 'LA', 'TX'].includes(state) && ((coastalDesignation && coastalDesignation.includes('Coastal')) || (state === 'TX' && county && county.toLowerCase().includes('harris')))) { region = 'coastal-gulf'; } } // Update the banner updateFPIResultsBanner(); document.getElementById('fpi-coverage-display').textContent = formatCurrencyValue(coverage); if (policyType && actualCategory && (category !== 'commercial' || vacancy)) { const rate = fpiRates[policyType][actualCategory]?.[region] || 0; document.getElementById('fpi-rate-display').textContent = formatCurrencyValue(rate); if (coverage) { const basePremium = Math.round(coverage * rate / 100); document.getElementById('fpi-premium-display').textContent = formatCurrencyValue(basePremium); // Dynamic tax calculation based on state const taxRates = getStateTaxRates(currentState); const surplusTax = Math.round(basePremium * taxRates.surplusLines); const stampTax = Math.round(basePremium * taxRates.stamping); const total = basePremium + surplusTax + stampTax; document.getElementById('fpi-surplus-tax-display').textContent = formatCurrencyValue(surplusTax); document.getElementById('fpi-stamp-tax-display').textContent = formatCurrencyValue(stampTax); document.getElementById('fpi-total-display').textContent = formatCurrencyValue(total); } else { document.getElementById('fpi-premium-display').textContent = formatCurrencyValue(0); document.getElementById('fpi-surplus-tax-display').textContent = formatCurrencyValue(0); document.getElementById('fpi-stamp-tax-display').textContent = formatCurrencyValue(0); document.getElementById('fpi-total-display').textContent = formatCurrencyValue(0); } } else { document.getElementById('fpi-rate-display').textContent = formatCurrencyValue(0); document.getElementById('fpi-premium-display').textContent = formatCurrencyValue(0); document.getElementById('fpi-surplus-tax-display').textContent = formatCurrencyValue(0); document.getElementById('fpi-stamp-tax-display').textContent = formatCurrencyValue(0); document.getElementById('fpi-total-display').textContent = formatCurrencyValue(0); } } function updateFloodCoverage() { const category = document.getElementById('flood-category').value; const buildingInput = document.getElementById('flood-building-coverage'); const contentsInput = document.getElementById('flood-contents-coverage'); const buildingLimitInfo = document.getElementById('building-limit-info'); const contentsLimitInfo = document.getElementById('contents-limit-info'); if (category && floodCoverageLimits[category]) { const limits = floodCoverageLimits[category]; if (limits.building > 0) { buildingLimitInfo.textContent = Maximum building coverage: ${formatCurrencyValue(limits.building)}; buildingInput.placeholder = Enter amount up to ${formatCurrencyValue(limits.building)}; } else { buildingLimitInfo.textContent = 'Building coverage is provided by the condominium association'; buildingInput.placeholder = 'Not available - covered by association'; buildingInput.value = ''; } contentsLimitInfo.textContent = Maximum contents coverage: ${formatCurrencyValue(limits.contents)}; contentsInput.placeholder = Enter amount up to ${formatCurrencyValue(limits.contents)}; } else { buildingLimitInfo.textContent = 'Coverage limits set automatically based on property type'; contentsLimitInfo.textContent = 'Contents limits set automatically based on property type'; buildingInput.placeholder = 'Enter building coverage amount'; contentsInput.placeholder = 'Enter contents coverage amount'; } // Clear any existing validation errors document.getElementById('building-error').style.display = 'none'; document.getElementById('contents-error').style.display = 'none'; buildingInput.classList.remove('input-error'); contentsInput.classList.remove('input-error'); } function updateContentsDisplay() { const hasContents = document.getElementById('flood-contents').value === 'yes'; const contentsGroup = document.getElementById('contents-coverage-group'); const contentsPremiumRow = document.getElementById('contents-premium-row'); if (hasContents) { contentsGroup.style.display = 'block'; contentsPremiumRow.style.display = 'flex'; } else { contentsGroup.style.display = 'none'; contentsPremiumRow.style.display = 'none'; // Clear contents coverage input document.getElementById('flood-contents-coverage').value = ''; } } function validateCoverage(type) { const category = document.getElementById('flood-category').value; if (!category) return true; const limits = floodCoverageLimits[category]; if (!limits) return true; let input, errorEl, maxLimit; if (type === 'building') { input = document.getElementById('flood-building-coverage'); errorEl = document.getElementById('building-error'); maxLimit = limits.building; } else { input = document.getElementById('flood-contents-coverage'); errorEl = document.getElementById('contents-error'); maxLimit = limits.contents; } if (!input || !errorEl) return true; const amount = parseCurrency(input.value); if (maxLimit === 0) { // Condominium building coverage is handled by association if (type === 'building') { input.classList.add('input-error'); errorEl.textContent = 'Building coverage is provided by the condominium association'; errorEl.style.display = 'block'; return false; } } else if (amount > maxLimit) { input.classList.add('input-error'); errorEl.textContent = Maximum coverage is ${formatCurrencyValue(maxLimit)}; errorEl.style.display = 'block'; return false; } else { input.classList.remove('input-error'); errorEl.style.display = 'none'; return true; } } function getFloodRate(propertyType, zone, state, coastalDesignation = '') { if (coastalDesignation?.includes('CHRA') && zone === 'A') { const chraRates = { 'default': { rate: 1.35, icc: 33, minPrem: 190 }, 'AL,MS': { rate: 2.50, icc: 33, minPrem: 190 }, 'MA': { rate: 1.22, icc: 33, minPrem: 190 }, 'HI': { rate: 1.75, icc: 33, minPrem: 190 }, 'LA': { rate: 5.00, icc: 33, minPrem: 190 }, 'TX': { rate: 1.65, icc: 33, minPrem: 190 } }; return findRateByState(chraRates, state); } if (coastalDesignation?.includes('CHR2') && zone === 'A') { const chr2Rates = { 'FL': { rate: 1.65, icc: 33, minPrem: 190 }, 'LA': { rate: 3.20, icc: 33, minPrem: 190 }, 'TX': { rate: 1.35, icc: 33, minPrem: 190 } }; if (chr2Rates[state]) return chr2Rates[state]; } if (floodRates.building[propertyType] && floodRates.building[propertyType][zone]) { return findRateByState(floodRates.building[propertyType][zone], state); } return { rate: 1.0, icc: 33, minPrem: 300 }; } function findRateByState(zoneRates, state) { if (zoneRates[state]) return zoneRates[state]; for (const [stateGroup, rateData] of Object.entries(zoneRates)) { if (stateGroup.includes(',') && stateGroup.split(',').includes(state)) { return rateData; } } return zoneRates.default || { rate: 1.0, icc: 33, minPrem: 300 }; } function calculateFlood() { const category = document.getElementById('flood-category').value; const stateInput = document.getElementById('flood-state').value; const zone = document.getElementById('flood-zone').value; const hasContents = document.getElementById('flood-contents').value === 'yes'; // Get coverage amounts from inputs const buildingCoverageStr = document.getElementById('flood-building-coverage').value; const contentsCoverageStr = document.getElementById('flood-contents-coverage').value; const buildingCoverage = parseCurrency(buildingCoverageStr); const contentsCoverage = parseCurrency(contentsCoverageStr); // If blank, populate inputs with maximum defaults so the user sees what's used const limits = floodCoverageLimits[category] || {building:0, contents:0}; if (!buildingCoverage && limits.building) { document.getElementById('flood-building-coverage').value = formatCurrencyValue(limits.building); } if (hasContents && !contentsCoverage && limits.contents) { document.getElementById('flood-contents-coverage').value = formatCurrencyValue(limits.contents); } if (category || stateInput || zone || buildingCoverageStr || contentsCoverageStr) { floodInteracted = true; } // Use address lookup data if available, otherwise use manual input const state = addressLookupData?.state || stateInput; const coastalDesignation = addressLookupData?.coastalDesignation; // Validate coverage amounts const validBuilding = validateCoverage('building'); const validContents = hasContents ? validateCoverage('contents') : true; if (validBuilding === false || validContents === false) { return; } // Update the flood results banner updateResultsBanner(); if (category && state && zone) { const limits = floodCoverageLimits[category]; if (!limits) return; const rateInfo = getFloodRate(category, zone, state, coastalDesignation); document.getElementById('flood-rate-display').textContent = formatCurrencyValue(rateInfo.rate); let buildingPremium = 0; let contentsPremium = 0; // Use entered building coverage or default to maximum if none entered const effectiveBuildingCoverage = buildingCoverage > 0 ? buildingCoverage : limits.building; // Show rate and coverage used document.getElementById('flood-rate-display').textContent = formatCurrencyValue(rateInfo.rate); document.getElementById('flood-coverage-display').textContent = formatCurrencyValue(effectiveBuildingCoverage); if (limits.building > 0 && effectiveBuildingCoverage > 0) { buildingPremium = (effectiveBuildingCoverage / 100) * rateInfo.rate; } if (hasContents) { // Use entered contents coverage or default to maximum if none entered const effectiveContentsCoverage = contentsCoverage > 0 ? contentsCoverage : limits.contents; if (limits.contents > 0 && effectiveContentsCoverage > 0) { const contentsRate = (zone === 'V') ? 3.00 : 1.40; contentsPremium = (effectiveContentsCoverage / 100) * contentsRate; } } const iccCharge = rateInfo.icc; let basePremium = buildingPremium + contentsPremium + iccCharge; if (basePremium < rateInfo.minPrem) { basePremium = rateInfo.minPrem; } document.getElementById('flood-contents-premium-display').textContent = formatCurrencyValue(Math.round(contentsPremium)); document.getElementById('flood-icc-display').textContent = formatCurrencyValue(iccCharge); document.getElementById('flood-pretax-display').textContent = formatCurrencyValue(Math.round(basePremium)); // Dynamic tax calculation based on state const currentState = state || 'DEFAULT'; const taxRates = getStateTaxRates(currentState); const surplusTax = Math.round(basePremium * taxRates.surplusLines); const stampTax = Math.round(basePremium * taxRates.stamping); const total = Math.round(basePremium) + surplusTax + stampTax; document.getElementById('flood-surplus-tax-display').textContent = formatCurrencyValue(surplusTax); document.getElementById('flood-stamp-tax-display').textContent = formatCurrencyValue(stampTax); document.getElementById('flood-total-display').textContent = formatCurrencyValue(total); } else { document.getElementById('flood-contents-premium-display').textContent = formatCurrencyValue(0); document.getElementById('flood-icc-display').textContent = formatCurrencyValue(0); document.getElementById('flood-pretax-display').textContent = formatCurrencyValue(0); document.getElementById('flood-surplus-tax-display').textContent = formatCurrencyValue(0); document.getElementById('flood-stamp-tax-display').textContent = formatCurrencyValue(0); document.getElementById('flood-total-display').textContent = formatCurrencyValue(0); document.getElementById('flood-rate-display').textContent = formatCurrencyValue(0); document.getElementById('flood-coverage-display').textContent = formatCurrencyValue(0); } } function calculateCancellation() { const policyType = document.getElementById('cancel-policy-type').value; const issueDate = document.getElementById('cancel-issue-date').value; const cancelDate = document.getElementById('cancel-cancel-date').value; const premiumStr = document.getElementById('cancel-premium').value; const premium = parseCurrency(premiumStr); if (policyType || issueDate || cancelDate || premiumStr) { cancelInteracted = true; } const statusEl = document.getElementById('cancel-status'); if (!cancelInteracted) { statusEl.style.display = 'none'; } else { statusEl.style.display = 'block'; if (!policyType) { statusEl.textContent = 'Next: Select the policy type to begin'; statusEl.className = 'status-indicator status-prompt'; } else if (!issueDate) { statusEl.textContent = 'Next: Confirm the policy issue date'; statusEl.className = 'status-indicator status-prompt'; } else if (!cancelDate) { statusEl.textContent = 'Next: Set the cancellation date'; statusEl.className = 'status-indicator status-prompt'; } else if (!premium) { statusEl.textContent = 'Next: Enter the annual premium amount to complete calculation'; statusEl.className = 'status-indicator status-prompt'; } else { statusEl.textContent = '✓ Calculation complete'; statusEl.className = 'status-indicator status-complete'; } } if (policyType && issueDate && cancelDate && premium) { const issueDateTime = new Date(issueDate); const cancelDateTime = new Date(cancelDate); const daysDiff = Math.ceil((cancelDateTime - issueDateTime) / (1000 * 60 * 60 * 24)); const daysInForce = Math.max(1, daysDiff); document.getElementById('cancel-days-display').textContent = daysInForce; let earnedPercent = 0; if (policyType === 'fpi') { document.getElementById('cancel-method-display').textContent = 'Short Rate Table'; earnedPercent = shortRateTable[Math.min(daysInForce, 365)] || 100; } else { document.getElementById('cancel-method-display').textContent = 'Pro-Rata'; earnedPercent = Math.min(Math.round((daysInForce / 365) * 100), 100); } document.getElementById('cancel-percent-display').textContent = ${earnedPercent}%; const earnedPremium = Math.round(premium * earnedPercent / 100); document.getElementById('cancel-earned-display').textContent = formatCurrencyValue(earnedPremium); const returnPremium = premium - earnedPremium; document.getElementById('cancel-return-display').textContent = formatCurrencyValue(returnPremium); } else { document.getElementById('cancel-days-display').textContent = '0'; document.getElementById('cancel-method-display').textContent = '-'; document.getElementById('cancel-percent-display').textContent = '0%'; document.getElementById('cancel-earned-display').textContent = formatCurrencyValue(0); document.getElementById('cancel-return-display').textContent = formatCurrencyValue(0); } } // Initialize when page loads document.addEventListener('DOMContentLoaded', function() { setDefaultDates(); // Initialize tax labels with default rates updateTaxLabels('DEFAULT', 'fpi-'); updateTaxLabels('DEFAULT', 'flood-'); }); function updateResultsBanner(opts = {}) { const { message, city, state, zip, county } = opts; const textEl = document.getElementById('results-banner-text'); const pillsEl = document.getElementById('results-banner-pills'); // Get form state to determine proper message const category = document.getElementById('flood-category').value; const zone = document.getElementById('flood-zone').value; const buildingCoverageStr = document.getElementById('flood-building-coverage').value; const hasContents = document.getElementById('flood-contents').value === 'yes'; const contentsCoverageStr = document.getElementById('flood-contents-coverage').value; // Determine status message based on form completion let statusMessage = ''; if (!category) { statusMessage = 'Next: Select the structure type'; } else if (!zone) { statusMessage = 'Next: Choose the flood zone'; } else if (!buildingCoverageStr) { statusMessage = 'Next: Enter building coverage amount'; } else if (hasContents && !contentsCoverageStr) { statusMessage = 'Next: Enter contents coverage amount'; } else { statusMessage = '✓ Quote calculated successfully'; } if (textEl) textEl.textContent = statusMessage; // Update location pills from address data with labels if (addressLookupData && pillsEl) { const cityValue = addressLookupData.city; const stateValue = addressLookupData.state; const countyValue = addressLookupData.county; const set = (id, label, val) => { const el = document.getElementById(id); if (!el) return; if (val) { el.innerHTML = <span class="pill-label">${label}:</span>${val}; el.style.display = 'inline-block'; } else { el.style.display = 'none'; } }; set('rb-city', 'City', cityValue); set('rb-state', 'State', stateValue); set('rb-county', 'County', countyValue); const hasAnyPill = !!(cityValue || stateValue || countyValue); pillsEl.style.display = hasAnyPill ? 'flex' : 'none'; } else if (pillsEl) { pillsEl.style.display = 'none'; } } </script> </body> </html>
